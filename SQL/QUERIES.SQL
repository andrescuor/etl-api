
SELECT d.department_name AS department,jt.job_title AS job, COUNT(CASE WHEN EXTRACT(QUARTER FROM e.hire_date) = 1 THEN 1 END) AS Q1, COUNT(CASE WHEN EXTRACT(QUARTER FROM e.hire_date) = 2 THEN 1 END) AS Q2, COUNT(CASE WHEN EXTRACT(QUARTER FROM e.hire_date) = 3 THEN 1 END) AS Q3, COUNT(CASE WHEN EXTRACT(QUARTER FROM e.hire_date) = 4 THEN 1 END) AS Q4 FROM hired_employees e JOIN departments d ON e.department_id = d.id JOIN jobs jt ON e.job_id = jt.id WHERE e.hire_date >= '2021-01-01' AND e.hire_date < '2022-01-01' GROUP BY d.department_name, jt.job_title ORDER BY d.department_name, jt.job_title DESC;

WITH department_hires AS (SELECT  d.id AS department_id, d.department_name, COUNT(e.id) AS employees_hiredFROM  hired_employees eJOIN  departments d ON e.department_id = d.idWHERE  e.hire_date >= '2021-01-01'  AND e.hire_date < '2022-01-01'GROUP BY  d.id, d.department_name ), mean_hires AS (SELECT  AVG(employees_hired) AS average_hiresFROM  department_hires ) SELECT dh.department_id,dh.department_name,dh.employees_hired FROM department_hires dh JOIN mean_hires mh ON dh.employees_hired > mh.average_hires ORDER BY dh.employees_hired DESC; 